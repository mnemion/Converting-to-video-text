# 체크포인트 1-1: 요구사항 정의 계획서

## 문서 목적
동영상 업로드 → 오디오 추출 → 음성 인식(전사) → 자막/텍스트 산출의 전체 흐름에 대한 기능/비기능 요구사항을 명확히 정의하고, 프런트/백엔드/인프라 간 인터페이스와 수용 기준을 합의한다.

## ✅ 실행 체크리스트 (MVP 우선)
- **백엔드 API**
  - [x] POST `/upload`
  - [x] POST `/transcribe`
  - [x] POST `/transcribe-async`
  - [x] GET `/status/{task_id}`
  - [x] 정적 제공 `/outputs/*`, `/uploads/*`

- **작업 큐/엔진**
  - [x] Celery/Redis 브로커·백엔드 연결
  - [x] FFmpeg 설치 및 경로 검증(`ffmpeg -version`)
  - [x] Whisper 모델 다운로드/캐시(base)

- **프런트엔드**
  - [x] 업로드 UI + 언어 선택
  - [x] 비동기 시작 액션(Pinia `startTranscription`)
  - [x] 상태 폴링(`/api/status/{task_id}`) 또는 WebSocket
  - [x] 결과 표시 + TXT/SRT 다운로드 버튼

- **실시간(선택)**
  - [ ] WebSocket `/ws/progress/{task_id}` 서버 구현
  - [ ] 클라이언트 WebSocket 연결/해제/재연결 처리

- **배포/운영**
  - [ ] Vite 프록시 8000 설정
  - [ ] Dockerfile(Uvicorn) / docker-compose(Celery/Redis)
  - [ ] 로깅/에러 응답 형식 정리

## 🔎 상세 체크박스
- **기능 요구사항**
  - [ ] 지원 포맷 준수(MP4/AVI/MOV/MKV/FLV/WMV)
  - [ ] 500MB 파일 크기 제한 및 검증
  - [ ] 언어 파라미터 수용(기본 `ko`)
  - [ ] TXT/SRT 산출물 생성
  - [ ] 작업 진행률 메타(PENDING/PROGRESS/SUCCESS/FAILURE)

- **비기능 요구사항**
  - [ ] CORS 설정(개발 `*`, 운영 특정 오리진)
  - [ ] 임시 파일 정리(업로드/오디오 중간 산출물)
  - [ ] 재시도/에러 메시지 포함 및 로깅
  - [ ] OpenAPI 문서(/docs) 자동 노출 확인
  - [ ] 브라우저 최신 2버전 호환성 확인

- **데이터/메타**
  - [ ] Job/Artifact 메타 스키마 합의(최소 필드셋)

- **수용 기준**
  - [ ] 업로드→전사→다운로드 E2E 성공
  - [ ] 실패 케이스 응답 형식 합의 및 테스트
  - [ ] 샘플 파일 3종(짧음/중간/길음) 테스트

## 범위
- 백엔드: FastAPI(+Uvicorn, ASGI), Celery/Redis, FFmpeg, Whisper
- 프런트엔드: Vue 3 + Vite + Pinia
- 저장소: PostgreSQL(메타데이터), 로컬 디스크 또는 S3(파일)

## 이해관계자
- 제품 담당자, 프런트엔드 개발자, 백엔드/데브옵스 개발자, QA, 최종 사용자(내부/외부)

## 사용자 페르소나 및 주요 유즈케이스
- 콘텐츠 제작자: 동영상 인터뷰를 신속히 텍스트화하고 자막 파일(SRT)을 생성
- 강의 운영자: 강의 영상의 스크립트 제작 및 검색성 개선
- 사내 기록 담당자: 회의 녹화본의 기록 및 아카이빙

## 기능 요구사항 (Functional)
1. 동영상 업로드
   - 지원 포맷: MP4/AVI/MOV/MKV/FLV/WMV
   - 최대 크기: 500MB (기본값)
   - 단일 파일 업로드 (MVP), 다중 파일은 차기 검토
2. 전사(ASR)
   - 엔진: OpenAI Whisper (기본 `base`, 옵션: tiny/small/medium/large)
   - 언어: ko/en/ja/zh/es/fr 등, 기본값 `ko`
   - 산출물: 텍스트(.txt), 자막(.srt)
3. 비동기 처리
   - 업로드 후 작업 등록(Celery) → 상태 조회(폴링 또는 WebSocket)
   - 진행률 메타 업데이트(PENDING/PROGRESS/SUCCESS/FAILURE)
4. 결과 제공/다운로드
   - 정적 경로 `/outputs/{job_id}.txt|.srt` 제공
   - UI에서 다운로드 버튼 노출
5. 이력 관리(선택)
   - 최근 N개 작업 내역 조회(프런트 로컬 상태 우선, 서버 보관은 옵션)

우선순위(MoSCoW)
- Must: 업로드, 전사, SRT/TXT 산출, 비동기 진행, 상태 조회, 다운로드
- Should: WebSocket 진행률 푸시, 언어 선택
- Could: 다중 파일 배치, 화자 분리, 클라우드 스토리지
- Won't (MVP): 실시간 스트리밍 인퍼런스

## 비기능 요구사항 (Non-Functional)
- 성능: 1시간 영상 처리 5~20분(모델/하드웨어에 따라 상이), 업로드 500MB 이내
- 확장성: Celery 워커 수평 확장, S3로 스토리지 전환 가능
- 신뢰성: 작업 실패 시 오류 메시지 및 재시도(기본 1회), 임시파일 정리
- 보안: 파일 확장자/사이즈 검증, CORS 제한(개발: *, 운영: 특정 오리진), 비공개 저장소 권장
- 관측성: 요청/응답 로깅, 태스크 상태/에러 로깅, 기본 메트릭 노출(차기)
- 호환성: 주요 브라우저 최신 2버전, API는 OpenAPI 호환 유지

## 제약/가정
- FFmpeg 설치 필수, Whisper 모델 다운로드 필요
- GPU 없을 시 `fp16=False`, 속도 저하 예상
- 동시 업로드/작업 수는 초기에는 소수(예: 3~5)로 제한

## API 초안 (FastAPI, 자동 문서: /docs)
- POST `/upload` → { filename, filepath }
- POST `/transcribe` (동기) → { job_id, text, txt_file, srt_file, language }
- POST `/transcribe-async` (비동기) → { job_id, task_id, status }
- GET `/status/{task_id}` → { state, progress?, result? }
- GET `/outputs/{job_id}.(txt|srt)` → 파일 다운로드

예시 요청/응답
```http
POST /transcribe-async
Content-Type: multipart/form-data

video: <file>
language: ko
```

```json
{
  "job_id": "b2f8...",
  "task_id": "b9c1...",
  "status": "processing"
}
```

## 데이터 모델 초안 (메타데이터)
- Job(job_id, filename, language, duration_sec, created_at, finished_at, status, error_message)
- Artifact(job_id, txt_path, srt_path, size_bytes)

## 수용 기준 (Acceptance Criteria)
- 500MB 이하의 지원 포맷 업로드 성공 및 서버 저장
- 비동기 전사 요청 시 태스크가 큐에 등록되고 상태 조회 가능
- 전사 완료 시 TXT/SRT가 생성되어 다운로드 가능
- 오류 발생 시 원인 메시지를 포함하여 실패 상태 반환
- OpenAPI 문서(/docs) 자동 생성 및 수동 테스트 가능

## 산출물
- 요구사항 명세서(본 문서)
- API 스키마(OpenAPI) 및 샘플 요청/응답
- UI 와이어프레임(업로드/진행/결과) 스케치

## 일정/작업량 추정
- 1~2일 (인터뷰/합의 0.5d, 문서화 0.5d, 와이어 0.5d, 리뷰 0.5d)

## 리스크 및 대응
- GPU 부재로 처리 지연: 모델 사이즈 전략(tiny/base) 및 워커 스케일아웃
- 다양한 코덱: FFmpeg 추출 실패 케이스 수집/정책화, 예외 로깅 강화
- 장시간 작업 타임아웃: 워커/브로커 타임아웃 설정 점검

## 승인
- 승인자: PM/Tech Lead
- 버전: v1.0 (초안)

